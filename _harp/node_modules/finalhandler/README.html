<h1>finalhandler</h1><p><a href="https://npmjs.org/package/finalhandler"><img src="https://img.shields.io/npm/v/finalhandler.svg" alt="NPM Version"></a>
<a href="https://npmjs.org/package/finalhandler"><img src="https://img.shields.io/npm/dm/finalhandler.svg" alt="NPM Downloads"></a>
<a href="https://nodejs.org/en/download"><img src="https://img.shields.io/node/v/finalhandler.svg" alt="Node.js Version"></a>
<a href="https://github.com/jshttp/pillarjs/finalhandler?query=workflow%3Aci"><img src="https://img.shields.io/github/workflow/status/pillarjs/finalhandler/ci/master?label=ci" alt="Build Status"></a>
<a href="https://coveralls.io/r/pillarjs/finalhandler?branch=master"><img src="https://img.shields.io/coveralls/pillarjs/finalhandler.svg" alt="Test Coverage"></a></p>
<p>Node.js function to invoke as the final step to respond to HTTP request.</p>
<h2>Installation</h2><p>This is a <a href="https://nodejs.org/en/">Node.js</a> module available through the
<a href="https://www.npmjs.com/">npm registry</a>. Installation is done using the
<a href="https://docs.npmjs.com/getting-started/installing-npm-packages-locally"><code>npm install</code> command</a>:</p>
<pre><code class="language-sh">$ npm install finalhandler
</code></pre>
<h2>API</h2><pre><code class="language-js">var finalhandler = require(&#39;finalhandler&#39;)
</code></pre>
<h3>finalhandler(req, res, [options])</h3><p>Returns function to be invoked as the final step for the given <code>req</code> and <code>res</code>.
This function is to be invoked as <code>fn(err)</code>. If <code>err</code> is falsy, the handler will
write out a 404 response to the <code>res</code>. If it is truthy, an error response will
be written out to the <code>res</code> or <code>res</code> will be terminated if a response has already
started.</p>
<p>When an error is written, the following information is added to the response:</p>
<ul>
<li>The <code>res.statusCode</code> is set from <code>err.status</code> (or <code>err.statusCode</code>). If
this value is outside the 4xx or 5xx range, it will be set to 500.</li>
<li>The <code>res.statusMessage</code> is set according to the status code.</li>
<li>The body will be the HTML of the status code message if <code>env</code> is
<code>&#39;production&#39;</code>, otherwise will be <code>err.stack</code>.</li>
<li>Any headers specified in an <code>err.headers</code> object.</li>
</ul>
<p>The final handler will also unpipe anything from <code>req</code> when it is invoked.</p>
<h4>options.env</h4><p>By default, the environment is determined by <code>NODE_ENV</code> variable, but it can be
overridden by this option.</p>
<h4>options.onerror</h4><p>Provide a function to be called with the <code>err</code> when it exists. Can be used for
writing errors to a central location without excessive function generation. Called
as <code>onerror(err, req, res)</code>.</p>
<h2>Examples</h2><h3>always 404</h3><pre><code class="language-js">var finalhandler = require(&#39;finalhandler&#39;)
var http = require(&#39;http&#39;)

var server = http.createServer(function (req, res) {
  var done = finalhandler(req, res)
  done()
})

server.listen(3000)
</code></pre>
<h3>perform simple action</h3><pre><code class="language-js">var finalhandler = require(&#39;finalhandler&#39;)
var fs = require(&#39;fs&#39;)
var http = require(&#39;http&#39;)

var server = http.createServer(function (req, res) {
  var done = finalhandler(req, res)

  fs.readFile(&#39;index.html&#39;, function (err, buf) {
    if (err) return done(err)
    res.setHeader(&#39;Content-Type&#39;, &#39;text/html&#39;)
    res.end(buf)
  })
})

server.listen(3000)
</code></pre>
<h3>use with middleware-style functions</h3><pre><code class="language-js">var finalhandler = require(&#39;finalhandler&#39;)
var http = require(&#39;http&#39;)
var serveStatic = require(&#39;serve-static&#39;)

var serve = serveStatic(&#39;public&#39;)

var server = http.createServer(function (req, res) {
  var done = finalhandler(req, res)
  serve(req, res, done)
})

server.listen(3000)
</code></pre>
<h3>keep log of all errors</h3><pre><code class="language-js">var finalhandler = require(&#39;finalhandler&#39;)
var fs = require(&#39;fs&#39;)
var http = require(&#39;http&#39;)

var server = http.createServer(function (req, res) {
  var done = finalhandler(req, res, { onerror: logerror })

  fs.readFile(&#39;index.html&#39;, function (err, buf) {
    if (err) return done(err)
    res.setHeader(&#39;Content-Type&#39;, &#39;text/html&#39;)
    res.end(buf)
  })
})

server.listen(3000)

function logerror (err) {
  console.error(err.stack || err.toString())
}
</code></pre>
<h2>License</h2><p><a href="LICENSE">MIT</a></p>
