<h1>gh-pages</h1><p>Publish files to a <code>gh-pages</code> branch on GitHub (or any other branch anywhere else).</p>
<h2>Getting Started</h2><pre><code class="language-shell">npm install gh-pages --save-dev
</code></pre>
<p>This module requires Git &gt;= 1.9 and Node &gt; 14.</p>
<h2>Basic Usage</h2><pre><code class="language-js">var ghpages = require(&#39;gh-pages&#39;);

ghpages.publish(&#39;dist&#39;, function(err) {});
</code></pre>
<h2><code>publish</code></h2><pre><code class="language-js">ghpages.publish(dir, callback);
// or...
ghpages.publish(dir, options, callback);
</code></pre>
<p>Calling this function will create a temporary clone of the current repository, create a <code>gh-pages</code> branch if one doesn&#39;t already exist, copy over all files from the base path, or only those that match patterns from the optional <code>src</code> configuration, commit all changes, and push to the <code>origin</code> remote.</p>
<p>If a <code>gh-pages</code> branch already exists, it will be updated with all commits from the remote before adding any commits from the provided <code>src</code> files.</p>
<p><strong>Note</strong> that any files in the <code>gh-pages</code> branch that are <em>not</em> in the <code>src</code> files <strong>will be removed</strong>.  See the <a href="#optionsadd"><code>add</code> option</a> if you don&#39;t want any of the existing files removed.</p>
<h3><a id="dir"><code>dir</code></a></h3><ul>
<li>type: <code>string</code></li>
</ul>
<p>The base directory for all source files (those listed in the <code>src</code> config property).</p>
<p>Example use:</p>
<pre><code class="language-js">/**
 * Given the following directory structure:
 *
 *   dist/
 *     index.html
 *     js/
 *       site.js
 *
 * The usage below will create a `gh-pages` branch that looks like this:
 *
 *   index.html
 *   js/
 *     site.js
 *
 */
ghpages.publish(&#39;dist&#39;, callback);
</code></pre>
<h3>Options</h3><p>The default options work for simple cases.  The options described below let you push to alternate branches, customize your commit messages and more.</p>
<h4><a id="optionssrc">options.src</a></h4><ul>
<li>type: <code>string|Array&lt;string&gt;</code></li>
<li>default: <code>&#39;**/*&#39;</code></li>
</ul>
<p>The <a href="https://github.com/isaacs/minimatch">minimatch</a> pattern or array of patterns is used to select which files should be published.</p>
<h4><a id="optionsbranch">options.branch</a></h4><ul>
<li>type: <code>string</code></li>
<li>default: <code>&#39;gh-pages&#39;</code></li>
<li><code>-b | --branch &lt;branch name&gt;</code></li>
</ul>
<p>The name of the branch you&#39;ll be pushing to.  The default uses GitHub&#39;s <code>gh-pages</code> branch, but this can be configured to push to any branch on any remote.</p>
<p>Example use of the <code>branch</code> option:</p>
<pre><code class="language-js">/**
 * This task pushes to the `master` branch of the configured `repo`.
 */
ghpages.publish(&#39;dist&#39;, {
  branch: &#39;master&#39;,
  repo: &#39;https://example.com/other/repo.git&#39;
}, callback);
</code></pre>
<h4><a id="optionsdest">options.dest</a></h4><ul>
<li>type: <code>string</code></li>
<li>default: <code>&#39;.&#39;</code></li>
</ul>
<p>The destination folder within the destination branch.  By default, all files are published to the root of the repository.</p>
<p>Example use of the <code>dest</code> option:</p>
<pre><code class="language-js">/**
 * Place content in the static/project subdirectory of the target
 * branch.
 */
ghpages.publish(&#39;dist&#39;, {
  dest: &#39;static/project&#39;
}, callback);
</code></pre>
<h4><a id="optionsdotfiles">options.dotfiles</a></h4><ul>
<li>type: <code>boolean</code></li>
<li>default: <code>false</code></li>
</ul>
<p>Include dotfiles.  By default, files starting with <code>.</code> are ignored unless they are explicitly provided in the <code>src</code> array.  If you want to also include dotfiles that otherwise match your <code>src</code> patterns, set <code>dotfiles: true</code> in your options.</p>
<p>Example use of the <code>dotfiles</code> option:</p>
<pre><code class="language-js">/**
 * The usage below will push dotfiles (directories and files)
 * that otherwise match the `src` pattern.
 */
ghpages.publish(&#39;dist&#39;, {dotfiles: true}, callback);
</code></pre>
<h4><a id="optionsnojekyll">options.nojekyll</a></h4><ul>
<li>type: <code>boolean</code></li>
<li>default: <code>false</code></li>
</ul>
<p>Write out a <code>.nojekyll</code> file to <a href="https://github.blog/2009-12-29-bypassing-jekyll-on-github-pages/">bypass Jekyll on GitHub Pages</a>.</p>
<p>Example use of the <code>nojekyll</code> option:</p>
<pre><code class="language-js">/**
 * The usage below will add a `.nojekyll` file to the output.
 */
ghpages.publish(&#39;dist&#39;, {nojekyll: true}, callback);
</code></pre>
<h4><a id="optionscname">options.cname</a></h4><ul>
<li>type: <code>string</code></li>
</ul>
<p>Write out a <code>CNAME</code> file with a custom domain name.</p>
<p>Example use of the <code>cname</code> option:</p>
<pre><code class="language-js">/**
 * The usage below will add a `CNAME` file to the output.
 */
ghpages.publish(&#39;dist&#39;, {cname: &#39;custom-domain.com&#39;}, callback);
</code></pre>
<h4><a id="optionsadd">options.add</a></h4><ul>
<li>type: <code>boolean</code></li>
<li>default: <code>false</code></li>
</ul>
<p>Only add, and never remove existing files.  By default, existing files in the target branch are removed before adding the ones from your <code>src</code> config.  If you want the task to add new <code>src</code> files but leave existing ones untouched, set <code>add: true</code> in your options.</p>
<p>Example use of the <code>add</code> option:</p>
<pre><code class="language-js">/**
 * The usage below will only add files to the `gh-pages` branch, never removing
 * any existing files (even if they don&#39;t exist in the `src` config).
 */
ghpages.publish(&#39;dist&#39;, {add: true}, callback);
</code></pre>
<h4><a id="optionsrepo">options.repo</a></h4><ul>
<li>type: <code>string</code></li>
<li>default: url for the origin remote of the current dir (assumes a git repository)</li>
<li><code>-r | --repo &lt;repo url&gt;</code></li>
</ul>
<p>By default, <code>gh-pages</code> assumes that the current working directory is a git repository, and that you want to push changes to the <code>origin</code> remote.</p>
<p>If instead your script is not in a git repository, or if you want to push to another repository, you can provide the repository URL in the <code>repo</code> option.</p>
<p>Example use of the <code>repo</code> option:</p>
<pre><code class="language-js">/**
 * If the current directory is not a clone of the repository you want to work
 * with, set the URL for the repository in the `repo` option.  This usage will
 * push all files in the `src` config to the `gh-pages` branch of the `repo`.
 */
ghpages.publish(&#39;dist&#39;, {
  repo: &#39;https://example.com/other/repo.git&#39;
}, callback);
</code></pre>
<h4><a id="optionsremote">options.remote</a></h4><ul>
<li>type: <code>string</code></li>
<li>default: <code>&#39;origin&#39;</code></li>
</ul>
<p>The name of the remote you&#39;ll be pushing to.  The default is your <code>&#39;origin&#39;</code> remote, but this can be configured to push to any remote.</p>
<p>Example use of the <code>remote</code> option:</p>
<pre><code class="language-js">/**
 * This task pushes to the `gh-pages` branch of of your `upstream` remote.
 */
ghpages.publish(&#39;dist&#39;, {
  remote: &#39;upstream&#39;
}, callback);
</code></pre>
<h4><a id="optionstag">options.tag</a></h4><ul>
<li>type: <code>string</code></li>
<li>default: <code>&#39;&#39;</code></li>
</ul>
<p>Create a tag after committing changes on the target branch.  By default, no tag is created.  To create a tag, provide the tag name as the option value.</p>
<h4><a id="optionsmessage">options.message</a></h4><ul>
<li>type: <code>string</code></li>
<li>default: <code>&#39;Updates&#39;</code></li>
</ul>
<p>The commit message for all commits.</p>
<p>Example use of the <code>message</code> option:</p>
<pre><code class="language-js">/**
 * This adds commits with a custom message.
 */
ghpages.publish(&#39;dist&#39;, {
  message: &#39;Auto-generated commit&#39;
}, callback);
</code></pre>
<h4><a id="optionsuser">options.user</a></h4><ul>
<li>type: <code>Object</code></li>
<li>default: <code>null</code></li>
</ul>
<p>If you are running the <code>gh-pages</code> task in a repository without a <code>user.name</code> or <code>user.email</code> git config properties (or on a machine without these global config properties), you must provide user info before git allows you to commit.  The <code>options.user</code> object accepts <code>name</code> and <code>email</code> string values to identify the committer.</p>
<p>Example use of the <code>user</code> option:</p>
<pre><code class="language-js">ghpages.publish(&#39;dist&#39;, {
  user: {
    name: &#39;Joe Code&#39;,
    email: &#39;coder@example.com&#39;
  }
}, callback);
</code></pre>
<h4><a id="optionsuser">options.remove</a></h4><ul>
<li>type: <code>string</code></li>
<li>default: <code>&#39;.&#39;</code></li>
</ul>
<p>Removes files that match the given pattern (Ignored if used together with
<code>--add</code>). By default, <code>gh-pages</code> removes everything inside the target branch
auto-generated directory before copying the new files from <code>dir</code>.</p>
<p>Example use of the <code>remove</code> option:</p>
<pre><code class="language-js">ghpages.publish(&#39;dist&#39;, {
  remove: &quot;*.json&quot;
}, callback);
</code></pre>
<h4><a id="optionspush">options.push</a></h4><ul>
<li>type: <code>boolean</code></li>
<li>default: <code>true</code></li>
</ul>
<p>Push branch to remote.  To commit only (with no push) set to <code>false</code>.</p>
<p>Example use of the <code>push</code> option:</p>
<pre><code class="language-js">ghpages.publish(&#39;dist&#39;, {push: false}, callback);
</code></pre>
<h4><a id="optionshistory">options.history</a></h4><ul>
<li>type: <code>boolean</code></li>
<li>default: <code>true</code></li>
</ul>
<p>Push force new commit without parent history.</p>
<p>Example use of the <code>history</code> option:</p>
<pre><code class="language-js">ghpages.publish(&#39;dist&#39;, {history: false}, callback);
</code></pre>
<h4><a id="optionssilent">options.silent</a></h4><ul>
<li>type: <code>boolean</code></li>
<li>default: <code>false</code></li>
</ul>
<p>Avoid showing repository URLs or other information in errors.</p>
<p>Example use of the <code>silent</code> option:</p>
<pre><code class="language-js">/**
 * This configuration will avoid logging the GH_TOKEN if there is an error.
 */
ghpages.publish(&#39;dist&#39;, {
  repo: &#39;https://&#39; + process.env.GH_TOKEN + &#39;@github.com/user/private-repo.git&#39;,
  silent: true
}, callback);
</code></pre>
<h4><a id="optionsbeforeadd">options.beforeAdd</a></h4><ul>
<li>type: <code>function</code></li>
<li>default: <code>null</code></li>
</ul>
<p>Custom callback that is executed right before <code>git add</code>.</p>
<p>The CLI expects a file exporting the beforeAdd function</p>
<pre><code class="language-bash">gh-pages --before-add ./cleanup.js
</code></pre>
<p>Example use of the <code>beforeAdd</code> option:</p>
<pre><code class="language-js">/**
 * beforeAdd makes most sense when `add` option is active
 * Assuming we want to keep everything on the gh-pages branch
 * but remove just `some-outdated-file.txt`
 */
ghpages.publish(&#39;dist&#39;, {
  add: true,
  async beforeAdd(git) {
    return git.rm(&#39;./some-outdated-file.txt&#39;);
  }
}, callback);
</code></pre>
<h4><a id="optionsgit">options.git</a></h4><ul>
<li>type: <code>string</code></li>
<li>default: <code>&#39;git&#39;</code></li>
</ul>
<p>Your <code>git</code> executable.</p>
<p>Example use of the <code>git</code> option:</p>
<pre><code class="language-js">/**
 * If `git` is not on your path, provide the path as shown below.
 */
ghpages.publish(&#39;dist&#39;, {
  git: &#39;/path/to/git&#39;
}, callback);
</code></pre>
<h2>Command Line Utility</h2><p>Installing the package creates a <code>gh-pages</code> command line utility.  Run <code>gh-pages --help</code> to see a list of supported options.</p>
<p>With a local install of <code>gh-pages</code>, you can set up a package script with something like the following:</p>
<pre><code class="language-shell">&quot;scripts&quot;: {
  &quot;deploy&quot;: &quot;gh-pages -d dist&quot;
}
</code></pre>
<p>And then to publish everything from your <code>dist</code> folder to your <code>gh-pages</code> branch, you&#39;d run this:</p>
<pre><code class="language-shell">npm run deploy
</code></pre>
<h2>GitHub Pages Project Sites</h2><p>There are three types of GitHub Pages sites: <a href="https://docs.github.com/en/pages/getting-started-with-github-pages/about-github-pages#types-of-github-pages-sites">project, user, and organization</a>. Since project sites are not hosted on the root <code>&lt;user|org&gt;.github.io</code> domain and instead under a URL path based on the repository name, they often require configuration tweaks for various build tools and frameworks. If not configured properly, a browser will usually log <code>net::ERR_ABORTED 404</code> errors when looking for compiled assets.</p>
<p>Examples:</p>
<ul>
<li>Create React App (which uses webpack under the hood) <a href="https://create-react-app.dev/docs/deployment/#building-for-relative-paths">requires the user to set a <code>&quot;homepage&quot;</code> property in their <code>package.json</code> so that built assets are referenced correctly in the final compiled HTML</a>.<ul>
<li>This <a href="https://github.com/tschaub/gh-pages/issues/285#issuecomment-805321474">has been often been thought of as an issue with <code>gh-pages</code></a>, though this package isn&#39;t able to control a project&#39;s build configuration.</li>
</ul>
</li>
<li>Vite <a href="https://vitejs.dev/guide/static-deploy.html#github-pages">requires a <code>&quot;base&quot;</code> property in its <code>vite.config.js</code></a></li>
<li>Next.js does not support deploying to GitHub Pages <a href="https://github.com/vercel/next.js/issues/9460">because of an opinionated static export approach that puts all assets under a <code>_next</code> direcotry that GitHub Pages ignores</a>.</li>
</ul>
<p>When using a project site, be sure to read the documentation for your particular build tool or framework to learn how to configure correct asset paths.</p>
<h2>Debugging</h2><p>To get additional output from the <code>gh-pages</code> script, set <code>NODE_DEBUG=gh-pages</code>.  For example:</p>
<pre><code class="language-shell">NODE_DEBUG=gh-pages npm run deploy
</code></pre>
<h2>Dependencies</h2><p>Note that this plugin requires Git 1.9 or higher (because it uses the <code>--exit-code</code> option for <code>git ls-remote</code>).  If you&#39;d like to see this working with earlier versions of Git, please <a href="https://github.com/tschaub/gh-pages/issues">open an issue</a>.</p>
<p><img src="https://github.com/tschaub/gh-pages/workflows/Test/badge.svg" alt="Test Status"></p>
<h2>Tips</h2><h3>when get error <code>branch already exists</code></h3><pre><code>{ ProcessError: fatal: A branch named &#39;gh-pages&#39; already exists.

    at ChildProcess.&lt;anonymous&gt; (~/node_modules/gh-pages/lib/git.js:42:16)
    at ChildProcess.emit (events.js:180:13)
    at maybeClose (internal/child_process.js:936:16)
    at Process.ChildProcess._handle.onexit (internal/child_process.js:220:5)
  code: 128,
  message: &#39;fatal: A branch named \&#39;gh-pages\&#39; already exists.\n&#39;,
  name: &#39;ProcessError&#39; }
</code></pre>
<p>The <code>gh-pages</code> module writes temporary files to a <code>node_modules/.cache/gh-pages</code> directory.  The location of this directory can be customized by setting the <code>CACHE_DIR</code> environment variable.</p>
<p>If <code>gh-pages</code> fails, you may find that you need to manually clean up the cache directory.  To remove the cache directory, run <code>node_modules/gh-pages/bin/gh-pages-clean</code> or remove <code>node_modules/.cache/gh-pages</code>.</p>
<h3>Deploying to github pages with custom domain</h3><p>Use the <code>--cname</code> option to create a <code>CNAME</code> file with the name of your custom domain.  See <a href="https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site/managing-a-custom-domain-for-your-github-pages-site">the GitHub docs</a> for more detail.</p>
<pre><code>gh-pages -d build --cname custom-domain.com&quot;
</code></pre>
<h3>Deploying with GitHub Actions</h3><p>In order to deploy with GitHub Actions, you will need to define a user and set the git repository for the process. See the example step below</p>
<pre><code class="language-yaml">- name: Deploy with gh-pages
  run: |
    git remote set-url origin https://git:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git
    npx gh-pages -d build -u &quot;github-actions-bot &lt;support+actions@github.com&gt;&quot;
   env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
</code></pre>
<p>The <code>secrets.GITHUB_TOKEN</code> is provided automatically as part of the GitHub Action and does not require any further configuration, but simply needs to be passed in as an environmental variable to the step. <code>GITHUB_REPOSITORY</code> is the owner and repository name and is also passed in automatically, but does not need to be added to the <code>env</code> list.</p>
<p>See <a href="https://github.com/tschaub/gh-pages/issues/345">Issue #345</a> for more information</p>
<h4>Deploying with GitHub Actions and a named script</h4><p>If you are using a named script in the <code>package.json</code> file to deploy, you will need to ensure you pass the variables properly to the wrapped <code>gh-pages</code> script. Given the <code>package.json</code> script below:</p>
<pre><code class="language-json">&quot;scripts&quot;: {
  &quot;deploy&quot;: &quot;gh-pages -d build&quot;
}
</code></pre>
<p>You will need to utilize the <code>--</code> option to pass any additional arguments:</p>
<pre><code class="language-yaml">- name: Deploy with gh-pages
  run: |
    git remote set-url origin https://git:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git
    npm run deploy -- -u &quot;github-actions-bot &lt;support+actions@github.com&gt;&quot;
  env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
</code></pre>
<p>See <a href="https://github.com/tschaub/gh-pages/pull/368">Pull Request #368</a> for more information.</p>
