<h1>cookie</h1><p><a href="https://npmjs.org/package/cookie"><img src="https://badgen.net/npm/v/cookie" alt="NPM Version"></a>
<a href="https://npmjs.org/package/cookie"><img src="https://badgen.net/npm/dm/cookie" alt="NPM Downloads"></a>
<a href="https://nodejs.org/en/download"><img src="https://badgen.net/npm/node/cookie" alt="Node.js Version"></a>
<a href="https://github.com/jshttp/cookie/actions/workflows/ci.yml"><img src="https://badgen.net/github/checks/jshttp/cookie/master?label=ci" alt="Build Status"></a>
<a href="https://coveralls.io/r/jshttp/cookie?branch=master"><img src="https://badgen.net/coveralls/c/github/jshttp/cookie/master" alt="Coverage Status"></a></p>
<p>Basic HTTP cookie parser and serializer for HTTP servers.</p>
<h2>Installation</h2><p>This is a <a href="https://nodejs.org/en/">Node.js</a> module available through the
<a href="https://www.npmjs.com/">npm registry</a>. Installation is done using the
<a href="https://docs.npmjs.com/getting-started/installing-npm-packages-locally"><code>npm install</code> command</a>:</p>
<pre><code class="language-sh">$ npm install cookie
</code></pre>
<h2>API</h2><pre><code class="language-js">var cookie = require(&#39;cookie&#39;);
</code></pre>
<h3>cookie.parse(str, options)</h3><p>Parse an HTTP <code>Cookie</code> header string and returning an object of all cookie name-value pairs.
The <code>str</code> argument is the string representing a <code>Cookie</code> header value and <code>options</code> is an
optional object containing additional parsing options.</p>
<pre><code class="language-js">var cookies = cookie.parse(&#39;foo=bar; equation=E%3Dmc%5E2&#39;);
// { foo: &#39;bar&#39;, equation: &#39;E=mc^2&#39; }
</code></pre>
<h4>Options</h4><p><code>cookie.parse</code> accepts these properties in the options object.</p>
<h5>decode</h5><p>Specifies a function that will be used to decode a cookie&#39;s value. Since the value of a cookie
has a limited character set (and must be a simple string), this function can be used to decode
a previously-encoded cookie value into a JavaScript string or other object.</p>
<p>The default function is the global <code>decodeURIComponent</code>, which will decode any URL-encoded
sequences into their byte representations.</p>
<p><strong>note</strong> if an error is thrown from this function, the original, non-decoded cookie value will
be returned as the cookie&#39;s value.</p>
<h3>cookie.serialize(name, value, options)</h3><p>Serialize a cookie name-value pair into a <code>Set-Cookie</code> header string. The <code>name</code> argument is the
name for the cookie, the <code>value</code> argument is the value to set the cookie to, and the <code>options</code>
argument is an optional object containing additional serialization options.</p>
<pre><code class="language-js">var setCookie = cookie.serialize(&#39;foo&#39;, &#39;bar&#39;);
// foo=bar
</code></pre>
<h4>Options</h4><p><code>cookie.serialize</code> accepts these properties in the options object.</p>
<h5>domain</h5><p>Specifies the value for the <a href="https://tools.ietf.org/html/rfc6265#section-5.2.3"><code>Domain</code> <code>Set-Cookie</code> attribute</a>. By default, no
domain is set, and most clients will consider the cookie to apply to only the current domain.</p>
<h5>encode</h5><p>Specifies a function that will be used to encode a cookie&#39;s value. Since value of a cookie
has a limited character set (and must be a simple string), this function can be used to encode
a value into a string suited for a cookie&#39;s value.</p>
<p>The default function is the global <code>encodeURIComponent</code>, which will encode a JavaScript string
into UTF-8 byte sequences and then URL-encode any that fall outside of the cookie range.</p>
<h5>expires</h5><p>Specifies the <code>Date</code> object to be the value for the <a href="https://tools.ietf.org/html/rfc6265#section-5.2.1"><code>Expires</code> <code>Set-Cookie</code> attribute</a>.
By default, no expiration is set, and most clients will consider this a &quot;non-persistent cookie&quot; and
will delete it on a condition like exiting a web browser application.</p>
<p><strong>note</strong> the <a href="https://tools.ietf.org/html/rfc6265#section-5.3">cookie storage model specification</a> states that if both <code>expires</code> and
<code>maxAge</code> are set, then <code>maxAge</code> takes precedence, but it is possible not all clients by obey this,
so if both are set, they should point to the same date and time.</p>
<h5>httpOnly</h5><p>Specifies the <code>boolean</code> value for the <a href="https://tools.ietf.org/html/rfc6265#section-5.2.6"><code>HttpOnly</code> <code>Set-Cookie</code> attribute</a>. When truthy,
the <code>HttpOnly</code> attribute is set, otherwise it is not. By default, the <code>HttpOnly</code> attribute is not set.</p>
<p><strong>note</strong> be careful when setting this to <code>true</code>, as compliant clients will not allow client-side
JavaScript to see the cookie in <code>document.cookie</code>.</p>
<h5>maxAge</h5><p>Specifies the <code>number</code> (in seconds) to be the value for the <a href="https://tools.ietf.org/html/rfc6265#section-5.2.2"><code>Max-Age</code> <code>Set-Cookie</code> attribute</a>.
The given number will be converted to an integer by rounding down. By default, no maximum age is set.</p>
<p><strong>note</strong> the <a href="https://tools.ietf.org/html/rfc6265#section-5.3">cookie storage model specification</a> states that if both <code>expires</code> and
<code>maxAge</code> are set, then <code>maxAge</code> takes precedence, but it is possible not all clients by obey this,
so if both are set, they should point to the same date and time.</p>
<h5>partitioned</h5><p>Specifies the <code>boolean</code> value for the <a href="rfc-cutler-httpbis-partitioned-cookies"><code>Partitioned</code> <code>Set-Cookie</code></a>
attribute. When truthy, the <code>Partitioned</code> attribute is set, otherwise it is not. By default, the
<code>Partitioned</code> attribute is not set.</p>
<p><strong>note</strong> This is an attribute that has not yet been fully standardized, and may change in the future.
This also means many clients may ignore this attribute until they understand it.</p>
<p>More information about can be found in <a href="https://github.com/privacycg/CHIPS">the proposal</a>.</p>
<h5>path</h5><p>Specifies the value for the <a href="https://tools.ietf.org/html/rfc6265#section-5.2.4"><code>Path</code> <code>Set-Cookie</code> attribute</a>. By default, the path
is considered the <a href="https://tools.ietf.org/html/rfc6265#section-5.1.4">&quot;default path&quot;</a>.</p>
<h5>priority</h5><p>Specifies the <code>string</code> to be the value for the <a href="https://tools.ietf.org/html/draft-west-cookie-priority-00#section-4.1"><code>Priority</code> <code>Set-Cookie</code> attribute</a>.</p>
<ul>
<li><code>&#39;low&#39;</code> will set the <code>Priority</code> attribute to <code>Low</code>.</li>
<li><code>&#39;medium&#39;</code> will set the <code>Priority</code> attribute to <code>Medium</code>, the default priority when not set.</li>
<li><code>&#39;high&#39;</code> will set the <code>Priority</code> attribute to <code>High</code>.</li>
</ul>
<p>More information about the different priority levels can be found in
<a href="https://tools.ietf.org/html/draft-west-cookie-priority-00#section-4.1">the specification</a>.</p>
<p><strong>note</strong> This is an attribute that has not yet been fully standardized, and may change in the future.
This also means many clients may ignore this attribute until they understand it.</p>
<h5>sameSite</h5><p>Specifies the <code>boolean</code> or <code>string</code> to be the value for the <a href="https://tools.ietf.org/html/draft-ietf-httpbis-rfc6265bis-09#section-5.4.7"><code>SameSite</code> <code>Set-Cookie</code> attribute</a>.</p>
<ul>
<li><code>true</code> will set the <code>SameSite</code> attribute to <code>Strict</code> for strict same site enforcement.</li>
<li><code>false</code> will not set the <code>SameSite</code> attribute.</li>
<li><code>&#39;lax&#39;</code> will set the <code>SameSite</code> attribute to <code>Lax</code> for lax same site enforcement.</li>
<li><code>&#39;none&#39;</code> will set the <code>SameSite</code> attribute to <code>None</code> for an explicit cross-site cookie.</li>
<li><code>&#39;strict&#39;</code> will set the <code>SameSite</code> attribute to <code>Strict</code> for strict same site enforcement.</li>
</ul>
<p>More information about the different enforcement levels can be found in
<a href="https://tools.ietf.org/html/draft-ietf-httpbis-rfc6265bis-09#section-5.4.7">the specification</a>.</p>
<p><strong>note</strong> This is an attribute that has not yet been fully standardized, and may change in the future.
This also means many clients may ignore this attribute until they understand it.</p>
<h5>secure</h5><p>Specifies the <code>boolean</code> value for the <a href="https://tools.ietf.org/html/rfc6265#section-5.2.5"><code>Secure</code> <code>Set-Cookie</code> attribute</a>. When truthy,
the <code>Secure</code> attribute is set, otherwise it is not. By default, the <code>Secure</code> attribute is not set.</p>
<p><strong>note</strong> be careful when setting this to <code>true</code>, as compliant clients will not send the cookie back to
the server in the future if the browser does not have an HTTPS connection.</p>
<h2>Example</h2><p>The following example uses this module in conjunction with the Node.js core HTTP server
to prompt a user for their name and display it back on future visits.</p>
<pre><code class="language-js">var cookie = require(&#39;cookie&#39;);
var escapeHtml = require(&#39;escape-html&#39;);
var http = require(&#39;http&#39;);
var url = require(&#39;url&#39;);

function onRequest(req, res) {
  // Parse the query string
  var query = url.parse(req.url, true, true).query;

  if (query &amp;&amp; query.name) {
    // Set a new cookie with the name
    res.setHeader(&#39;Set-Cookie&#39;, cookie.serialize(&#39;name&#39;, String(query.name), {
      httpOnly: true,
      maxAge: 60 * 60 * 24 * 7 // 1 week
    }));

    // Redirect back after setting cookie
    res.statusCode = 302;
    res.setHeader(&#39;Location&#39;, req.headers.referer || &#39;/&#39;);
    res.end();
    return;
  }

  // Parse the cookies on the request
  var cookies = cookie.parse(req.headers.cookie || &#39;&#39;);

  // Get the visitor name set in the cookie
  var name = cookies.name;

  res.setHeader(&#39;Content-Type&#39;, &#39;text/html; charset=UTF-8&#39;);

  if (name) {
    res.write(&#39;&lt;p&gt;Welcome back, &lt;b&gt;&#39; + escapeHtml(name) + &#39;&lt;/b&gt;!&lt;/p&gt;&#39;);
  } else {
    res.write(&#39;&lt;p&gt;Hello, new visitor!&lt;/p&gt;&#39;);
  }

  res.write(&#39;&lt;form method=&quot;GET&quot;&gt;&#39;);
  res.write(&#39;&lt;input placeholder=&quot;enter your name&quot; name=&quot;name&quot;&gt; &lt;input type=&quot;submit&quot; value=&quot;Set Name&quot;&gt;&#39;);
  res.end(&#39;&lt;/form&gt;&#39;);
}

http.createServer(onRequest).listen(3000);
</code></pre>
<h2>Testing</h2><pre><code class="language-sh">$ npm test
</code></pre>
<h2>Benchmark</h2><pre><code>$ npm run bench

&gt; cookie@0.5.0 bench
&gt; node benchmark/index.js

  node@18.18.2
  acorn@8.10.0
  ada@2.6.0
  ares@1.19.1
  brotli@1.0.9
  cldr@43.1
  icu@73.2
  llhttp@6.0.11
  modules@108
  napi@9
  nghttp2@1.57.0
  nghttp3@0.7.0
  ngtcp2@0.8.1
  openssl@3.0.10+quic
  simdutf@3.2.14
  tz@2023c
  undici@5.26.3
  unicode@15.0
  uv@1.44.2
  uvwasi@0.0.18
  v8@10.2.154.26-node.26
  zlib@1.2.13.1-motley

&gt; node benchmark/parse-top.js

  cookie.parse - top sites

  14 tests completed.

  parse accounts.google.com x 2,588,913 ops/sec ±0.74% (186 runs sampled)
  parse apple.com           x 2,370,002 ops/sec ±0.69% (186 runs sampled)
  parse cloudflare.com      x 2,213,102 ops/sec ±0.88% (188 runs sampled)
  parse docs.google.com     x 2,194,157 ops/sec ±1.03% (184 runs sampled)
  parse drive.google.com    x 2,265,084 ops/sec ±0.79% (187 runs sampled)
  parse en.wikipedia.org    x   457,099 ops/sec ±0.81% (186 runs sampled)
  parse linkedin.com        x   504,407 ops/sec ±0.89% (186 runs sampled)
  parse maps.google.com     x 1,230,959 ops/sec ±0.98% (186 runs sampled)
  parse microsoft.com       x   926,294 ops/sec ±0.88% (184 runs sampled)
  parse play.google.com     x 2,311,338 ops/sec ±0.83% (185 runs sampled)
  parse support.google.com  x 1,508,850 ops/sec ±0.86% (186 runs sampled)
  parse www.google.com      x 1,022,582 ops/sec ±1.32% (182 runs sampled)
  parse youtu.be            x   332,136 ops/sec ±1.02% (185 runs sampled)
  parse youtube.com         x   323,833 ops/sec ±0.77% (183 runs sampled)

&gt; node benchmark/parse.js

  cookie.parse - generic

  6 tests completed.

  simple      x 3,214,032 ops/sec ±1.61% (183 runs sampled)
  decode      x   587,237 ops/sec ±1.16% (187 runs sampled)
  unquote     x 2,954,618 ops/sec ±1.35% (183 runs sampled)
  duplicates  x   857,008 ops/sec ±0.89% (187 runs sampled)
  10 cookies  x   292,133 ops/sec ±0.89% (187 runs sampled)
  100 cookies x    22,610 ops/sec ±0.68% (187 runs sampled)
</code></pre>
<h2>References</h2><ul>
<li><a href="https://tools.ietf.org/html/rfc6265">RFC 6265: HTTP State Management Mechanism</a></li>
<li><a href="https://tools.ietf.org/html/draft-ietf-httpbis-rfc6265bis-09#section-5.4.7">Same-site Cookies</a></li>
</ul>
<h2>License</h2><p><a href="LICENSE">MIT</a></p>
